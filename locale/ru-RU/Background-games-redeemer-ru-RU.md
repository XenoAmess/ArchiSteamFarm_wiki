# Фоновая активация ключей

Фоновая активация ключей - встроенная в ASF функция, позволяющая ввести определённый набор ключей Steam (вместе с их именами) для активации в фоновом режиме. Эта функция особенно полезна в связке с множеством ключей, которые нужно активировать, когда Вы гарантировано получите `RateLimited` **[status](https://github.com/JustArchi/ArchiSteamFarm/wiki/FAQ#what-is-the-meaning-of-status-when-redeeming-a-key)** до того как вы закончите активацию все пака.

Фоновая активация ключей нацелена на использование для одного бота, что означает, что функция не использует `RedeemingPreferences`. Данную функцию можно использовать вместе с (или вместо) `redeem` **[command](https://github.com/JustArchi/ArchiSteamFarm/wiki/Commands)**, если нужно.

* * *

## Импорт

Импортировать возможно с помощью двух способов - используя файлы или IPC.

### Файл

ASF увидит в папке `config` файл с названием `BotName.keys`, где `BotName` - имя бота. У файла есть определённая структура в виде названия игры и ключа от неё, отделённые символом табуляции и заканчивающаяся новой строкой. Если используется несколько символов табуляции, к примеру, в названии игры, то считается только последний, при этом предыдущие считаются как часть названия игры, и конвертируются в пробелы. Например:

    POSTAL 2    ABCDE-EFGHJ-IJKLM
    Domino Craft VR 12345-67890-ZXCVB
    A Week of Circus Terror POIUY-KJHGD-QWERT
    

ASF импортирует данный файл, при запуске бота или позже при выполнении. После успешного считывания вашего файла и возможного пропуска неудачных попыток,все правильно распознанные игры будут добавлены в очередь и `BotName.keys` будет удалён с `config` директории.

### IPC

Кроме использования файла с ключами, упомянутого выше, ASF поддерживает **[сервис API](https://github.com/JustArchi/ArchiSteamFarm/wiki/IPC#post-apigamestoredeeminbackgroundbotname)** вместе с `GamesToRedeemInBackground`, который может быть запущен с помощью любого IPC инструмента, включая наш IPC GUI. Использование IPC может быть более мощным, так как Вы можете настроить подходящее для Вас считывание самостоятельно, например использование кастомного ограничителя вместо принудительного символа табуляции.

* * *

## Очередь

Когда игра успешно импортирована, она добавляется в очередь. ASF автоматически проходит фоновую очередь пока бот подключен к сети Steam и очередь не пуста. A key that was attempted to be redeemed and did not result in `RateLimited` is removed from the queue, with its status properly written to a file in `config` directory - either `BotName.keys.used` if the key was used in the process (e.g. `NoDetail`, `BadActivationCode`, `DuplicateActivationCode`), or `BotName.keys.unused` otherwise. ASF намеренно использует предоставленное Вами имя игры, так как сеть Steam не гарантирует правильность возвращенного имени игры, также Вы можете называть ваш файл с ключами пользовательским именем если нужно/желаемо.

Если во время процесса наш аккаунт получает `RateLimited` статус, очередь будет временно приостановлена на час для ожидания исчезновения кулдауна. После ожидания процесс продолжится с места, где он остановился, пока очередь не исчезнет.

* * *

## Пример

Предположим у Вас есть список со 100 ключей. Сначала Вам нужно создать новый `BotName.keys.new` файл в ASF директории `config`. Для того чтобы указать ASF что файл не нужно использовать сразу после создания(так как сразу после создания он пустой,пока что неготовый к использованию),мы добавляем расширение `new`.

Теперь Вы можете открыть наш новый файл и вставить список со 100 ключей, при необходимости указывая формат. После поправок наш `BotName.keys.new` файл будет в точности иметь 100(или 101,с последней новой строкой)строк,имея структуру строки `GameName\tcd-key\n`,где `\t` это символ табуляции,а `\n` - новая строка.

Теперь Вы готовы сменить имя файла с `BotName.keys.new` на `BotName.keys`,для того чтобы указать ASF что файл готов к использованию. Сразу после того как Вы это сделали, ASF начнёт автоматически импортировать файл(без перезагрузки) и потом удалит его, подтверждая то, что все наши игры были считаны и добавлены в очередь.

Вместо использования `BotName.keys` файла,вы можете использовать IPC API или даже комбинировать оба метода,если хотите.

После некоторого времени,файлы `BotName.keys.used` и `BotName.keys.unused` могут сгенерироваться. Эти файлы содержат результат нашего процесса активации ключей. Например,вы можете переименовать файл `BotName.keys.unused` в `BotName2.keys`,следовательно,передать наши неиспользованные ключи другому боту,так как предыдущий бот не использовал эти ключи для себя. Или просто копипастнуть неиспользованные ключи в какой-то другой файл и придержать его до следующей активации. Помните, что ASF проходит очередь, новые попытки активации будут добавлены к нашим выходным `used` и `unused` файлам, по этому рекомендуется подождать окончания очереди, перед тем как добавлять новые ключи. Если вам крайне необходимо активировать новые файлы, прежде чем очередь закончилась, сначала следует **перенести** выходной файл, который Вы хотите использовать, в другую директорию и **после** этого считать его. Потому что ASF может добавить новые результаты в то время,когда Вы создаёте новый файл,и это может привести к потере ключей,например если Вы считали файл,который содержит 3 ключа внутри,потом удалили его,Вы упускаете тот факт,что в это время ASF добавил 4 ключа в ваш удалённый файл. Если вы хотите получить доступ к этих файлам, убедитесь что они перемещены с ASF `config` директории, перед тем как считать их, например переименованием.

Повторяя все шаги выше, можно добавить дополнительные игры для импортирования, вовремя наличия игр, которые уже находятся в очереди. ASF должным образом добавит наши дополнительные попытки к уже выполняющейся очереди и в итоге справится с этим.

* * *

## Примечания

Background keys redeemer uses `OrderedDictionary` under the hood, which means that your cd-keys will have preserved order as they were specified in the file (or IPC API call). This means that you can (and should) provide a list where given cd-key can only have direct dependencies on cd-keys listed above, but not below. For example, this means that if you have DLC `D` that requires game `G` to be activated firstly, then cd-key for game `G` should **always** be included before cd-key for DLC `D`. Likewise, if DLC `D` would have dependencies on `A`, `B` and `C`, then all 3 should be included before (in any order, unless they have dependencies on their own).

Not following the scheme above will result in your DLC not being activated with `DoesNotOwnRequiredApp`, even if your account would be eligible for activating it after going through its entire queue. If you want to avoid that then you must make sure that your DLC is always included after the base game in your queue.